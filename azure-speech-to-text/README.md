# Azure Speech STT Utility (`azure_speech_to_text.py`)

A small command-line tool for running batch or single-file speech-to-text (STT) using **Azure Cognitive Services Speech SDK**.

The script can generate:

- Plain text files: `.txt`
- Tab-separated files with timestamps: `.tsv`
- Subtitle files: `.srt`, `.vtt`  

> Note: Command-line help and log messages are mainly in Chinese, but the tool supports multiple recognition languages (e.g. `zh-CN`, `en-US`, `fr-CA`).

---

## Features

- Support **single audio file** or **all audio files in a directory**
- Support common audio formats:  
  `.wav`, `.mp3`, `.mp4`, `.m4a`, `.wma`, `.ogg`, `.flac`, `.aac`
- Use Azure Speech **continuous recognition** and **Detailed output** to get timestamps
- Export:
  - `.txt` – one recognized segment per line
  - `.tsv` – `start_s`, `end_s`, `text`
  - `.srt` – standard SRT subtitles
  - `.vtt` – WebVTT subtitles
- If no output format is specified, **all four formats** are generated by default

---

## Requirements

- Python **3.8+** (recommended)
- Azure Cognitive Services Speech SDK for Python:

```bash
pip install azure-cognitiveservices-speech
```

- An Azure Speech resource:
  - A valid `SPEECH_KEY`
  - Either `SPEECH_REGION` **or** `SPEECH_ENDPOINT`

---

## Environment variables

The script reads credentials from environment variables:

- `SPEECH_KEY` (required)  
- `SPEECH_REGION` **or** `SPEECH_ENDPOINT` (at least one of them is required)

Example (Linux / macOS, bash):

```bash
export SPEECH_KEY="your_speech_key_here"
export SPEECH_REGION="eastasia"   # or other region, e.g. westus, canadacentral, etc.
# export SPEECH_ENDPOINT="https://<your-custom-endpoint>.cognitiveservices.azure.com/"
```

On Windows PowerShell:

```powershell
$env:SPEECH_KEY = "your_speech_key_here"
$env:SPEECH_REGION = "eastasia"
```

---

## Usage

Assume the script file is named **`azure_speech_to_text.py`**.

### 1. Single file, Chinese recognition, all output formats

```bash
python azure_speech_to_text.py -i ~/speechcli/audio/sample_audio.wav -l zh-CN
```

This will create `sample_audio.txt`, `.tsv`, `.srt`, `.vtt` in the default output directory `~/speechcli/stt_out`.

### 2. Batch process all audio files in a directory (Chinese)

```bash
python azure_speech_to_text.py -i ~/speechcli/audio -l zh-CN --srt --vtt
```

This processes all supported audio files in `~/speechcli/audio` and outputs only `.srt` and `.vtt` subtitle files.

### 3. English recognition, only TXT output

```bash
python azure_speech_to_text.py -i ~/speechcli/audio/file_en.wav -l en-US --txt
```

### 4. Custom output directory

```bash
python azure_speech_to_text.py -i ./input_audio -l zh-CN -o ./stt_results --txt --tsv
```

---

## Command-line options

```text
-i, --input      Input file or directory (required)
-l, --lang       Recognition language (default: zh-CN, e.g. en-US, fr-CA)
-o, --outdir     Output directory (default: ~/speechcli/stt_out)
--txt            Export .txt (one line per segment)
--tsv            Export .tsv (with start/end time in seconds)
--srt            Export .srt subtitles
--vtt            Export .vtt subtitles
```

Notes:

- If **no** output format is specified, the script will export **all** four types: TXT/TSV/SRT/VTT.
- If the input is a directory, only files with supported audio extensions will be processed.

---

## Known limitations / notes

- This script uses Azure Speech **continuous recognition** from a file. Very long audio files may take some time to process.
- The script currently searches only the **top level** of the input directory (no recursive subfolders).
- On some systems file extensions may be case-sensitive; if your audio files have uppercase extensions (e.g. `.WAV`), you may want to rename them or adjust the script accordingly.

---

## License

This script is created for **personal use and learning**.  
Please check Azure Cognitive Services pricing and terms before using it for large-scale or commercial processing.
